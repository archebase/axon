version: '3.8'

# Docker Compose configuration for running tests
# Usage: docker-compose -f docker/docker-compose.test.yml up --abort-on-container-exit

services:
  test-ros1:
    build:
      context: ..
      dockerfile: docker/Dockerfile.ros1
    container_name: lance_recorder_test_ros1
    volumes:
      - ../:/workspace/edge_lance_recorder
    environment:
      - ROS_DISTRO=noetic
      - ROS_VERSION=1
    command: /usr/local/bin/run_tests.sh
    network_mode: host

  test-ros2-humble:
    build:
      context: ..
      dockerfile: docker/Dockerfile.ros2.humble
    container_name: lance_recorder_test_ros2_humble
    volumes:
      - ../:/workspace/edge_lance_recorder
    environment:
      - ROS_DISTRO=humble
      - ROS_VERSION=2
    command: /usr/local/bin/run_tests.sh
    network_mode: host

  test-ros2-jazzy:
    build:
      context: ..
      dockerfile: docker/Dockerfile.ros2.jazzy
    container_name: lance_recorder_test_ros2_jazzy
    volumes:
      - ../:/workspace/edge_lance_recorder
    environment:
      - ROS_DISTRO=jazzy
      - ROS_VERSION=2
    command: /usr/local/bin/run_tests.sh
    network_mode: host

  test-ros2-rolling:
    build:
      context: ..
      dockerfile: docker/Dockerfile.ros2.rolling
    container_name: lance_recorder_test_ros2_rolling
    volumes:
      - ../:/workspace/edge_lance_recorder
    environment:
      - ROS_DISTRO=rolling
      - ROS_VERSION=2
    command: /usr/local/bin/run_tests.sh
    network_mode: host



