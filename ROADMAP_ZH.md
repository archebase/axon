# Axon 开发路线图（最终版）

本文档概述 Axon 项目的开发路线图。Axon 是一个**同进程**、具有插件化架构的高性能机器人数据录制工具，核心目标是在高带宽（图像/点云）场景下稳定工作，并提供可观测、可运维的录制能力。

## 0.2.0 版本（当前版本）

**重点：插件架构与核心录制引擎**

### 插件系统（核心功能）
- ✅ **插件架构**：中间件无关的核心，支持动态插件加载
  - 统一的 C ABI 接口，便于扩展
  - 运行时插件发现（`dlopen/dlsym`）
  - 基于版本的 ABI 兼容性检查
  - 清晰分离：核心库零 ROS 依赖
- ✅ **ROS1 插件**：支持 ROS1 Noetic（`libaxon_ros1.so`）
  - 主题订阅与消息内省
  - roscpp 集成与插件生命周期管理
- ✅ **ROS2 插件**：支持 ROS2 Humble/Jazzy/Rolling（`libaxon_ros2.so`）
  - 基于 rclcpp 的执行器集成
  - 现代 CMake 目标
  - 多版本兼容性测试

### 录制引擎
- ✅ **任务中心设计**：一个任务 = 一个 MCAP 文件，全生命周期管理
- ✅ **状态机**：4 状态有限状态机（IDLE → READY → RECORDING ↔ PAUSED）
- ✅ **队列与并发模型（现状说明）**
  - 每主题队列（SPSC/MPSC 视实现而定），面向高吞吐
  - 目标：copy-minimized 消息路径（尽量减少分配与拷贝）
- ✅ **MCAP 格式**
  - Zstd/LZ4 压缩支持
  - 元数据注入（任务/设备/录制信息）
  - Sidecar JSON 生成，便于快速元数据访问
- ✅ **工作线程池（现状说明）**
  - 并行主题处理，面向高吞吐录制

### 远程控制与车队集成
- ✅ **HTTP RPC API**（RESTful）
  - `POST /rpc/config` - 设置任务配置（IDLE → READY）
  - `POST /rpc/begin` - 开始录制（READY → RECORDING）
  - `POST /rpc/pause` - 暂停录制（RECORDING → PAUSED）
  - `POST /rpc/resume` - 恢复录制（PAUSED → RECORDING）
  - `POST /rpc/end` - 结束录制（RECORDING/PAUSED → IDLE）
  - `POST /rpc/quit` - 关闭录制器
  - `GET /rpc/state` - 查询状态和版本
  - `GET /rpc/stats` - 获取录制统计信息
- ✅ **HTTP 回调**：自动向车队服务器发送开始/完成通知
- ✅ **版本管理**：从 CMake 统一管理版本（0.2.0）
  - `--version` CLI 选项
  - HTTP API 响应中的版本信息

### 测试与质量
- ✅ 全面的单元测试和集成测试
- ✅ 带模拟插件的端到端测试
- ✅ 代码覆盖率报告（Codecov 集成）
- ✅ CI/CD 流水线（GitHub Actions）
- ✅ 静态分析：C++ 使用 cppcheck，Rust 使用 clippy
- ✅ 代码格式化：基于 Google 风格的 clang-format
- ✅ Pre-commit hooks 基础设施

---

## 0.3.0 版本（计划中）

**重点：Web 控制面板、二进制嵌入、可用性提升**

### Web 控制面板（AxonPanel）
- [ ] 前端界面
  - [ ] 实时状态显示
  - [ ] 录制控制按钮
  - [ ] 主题订阅管理
  - [ ] 实时统计图表
- [ ] 后端集成
  - [ ] WebSocket 实时推送
  - [ ] RESTful API 调用封装
- [ ] 部署支持
  - [ ] 静态资源内嵌到二进制
  - [ ] 独立部署模式

### 二进制文件嵌入 MCAP
- [ ] 嵌入格式设计
  - [ ] MCAP attachment 机制
  - [ ] 自定义 schema 定义
  - [ ] 元数据关联
- [ ] 嵌入内容类型
  - [ ] 设备型号
  - [ ] 机器人描述文件
  - [ ] 标定文件
  - [ ] 自定义附件


### 可用性提升
- [ ] 配置管理增强
  - [ ] 配置验证与错误提示
  - [ ] 更多配置模板与预设
- [ ] 录制任务管理
  - [ ] 任务列表查看
  - [ ] 批量操作
- [ ] 日志与排障
  - [ ] 日志级别动态调整
  - [ ] 关键事件高亮显示
  - [ ] 错误诊断建议

---

## 0.4.0 版本（性能优化）

**重点：内存与拷贝优化、阻塞式回压**

### 内存优化
- [ ] 零拷贝优化
  - [ ] 避免序列化时的额外拷贝
- [ ] 内存池与预分配
  - [ ] 消息 buffer 池化
  - [ ] 批处理 buffer 复用
  - [ ] 预分配策略

### 拷贝优化
- [ ] 批量写入
  - [ ] 多消息聚合后一次性写入
  - [ ] 减少系统调用次数
- [ ] 压缩优化
  - [ ] 压缩与写盘解耦
  - [ ] Zstd/LZ4 压缩基准对比
  - [ ] 可选压缩级别调优

### 阻塞式回压
- [ ] 阻塞边界控制
  - [ ] 允许阻塞订阅线程
  - [ ] **禁止阻塞 RPC/控制线程**
- [ ] 线程组隔离
  - [ ] 录制订阅使用独立执行器/线程
  - [ ] 控制面独立线程池

---

## 0.5.0 版本（未来）

**重点：安全基线 + 运维能力增强+ 选择性录制**

### 安全增强（安全默认值）
- [ ] HTTPS/TLS 支持
- [ ] API 密钥认证
  - [ ] 密钥加载与轮换流程
- [ ] 安全默认值
  - [ ] 默认仅监听 `localhost`
  - [ ] 回调 URL allowlist

### 运维与告警
- [ ] 磁盘空间阈值监测与告警
- [ ] 长时间阻塞告警

### 选择性主题录制
- [ ] 正则表达式匹配主题名称
- [ ] 主题黑白名单机制
- [ ] 按需订阅

---

## 0.6.0 版本（长期）

**重点：企业功能与生态系统（在 0.3/0.4 稳定基础上扩展）**

### 企业功能
- [ ] 多租户支持与身份认证/授权
  - [ ] JWT 身份认证
  - [ ] API 密钥管理

### 高级监控
- [ ] 消息完整性监控
  - [ ] 序列号追踪
  - [ ] 消息缺口检测与报告
  - [ ] 丢包率统计
  - [ ] 实时告警通知
- [ ] 延迟监控
  - [ ] 端到端延迟追踪
  - [ ] 每主题延迟百分位报告
  - [ ] 延迟异常检测与告警
  - [ ] 延迟热点分析
- [ ] 服务质量监控
  - [ ] 带宽利用率
  - [ ] 队列深度监控

### 生态系统与扩展性
- [ ] 插件 SDK 与文档
  - [ ] C/C++ SDK
  - [ ] 插件开发指南与示例插件
- [ ] 自定义集成 SDK
  - [ ] Python 绑定
- [ ] 录制管理 CLI 工具
  - [ ] 录制检查、批量操作、数据导出

---

## 1.0.0 版本（稳定版）

**重点：生产就绪与长期支持**

### 生产就绪
- [ ] 测试覆盖率目标
  - [ ] 核心录制/写盘/停止收尾/崩溃修复路径高覆盖
  - [ ] 关键错误路径与边界条件覆盖
- [ ] 性能基准测试与优化
  - [ ] 基线性能指标固化
  - [ ] 与 rosbag/rosbag2 的对比与迁移建议
- [ ] 安全审计与渗透测试
  - [ ] 漏洞评估与安全加固
- [ ] 生产部署指南
  - [ ] 最佳实践文档
  - [ ] 故障排除指南与 FAQ
- [ ] 全面的文档与教程
  - [ ] 入门与高级使用指南
  - [ ] 示例配置与常见场景

### 长期支持
- [ ] 向后兼容性保证
  - [ ] 插件 ABI 稳定策略
  - [ ] 弃用策略与迁移指南
- [ ] 稳定的插件 ABI
  - [ ] 版本控制方案
  - [ ] 兼容性测试与插件验证工具

---

## 贡献优先级

我们欢迎社区贡献！优先领域：

1. **文档**：教程、示例和用例
2. **测试**：集成测试、边界情况覆盖
3. **性能**：基准测试、性能分析、优化
4. **功能**：查看带有 `good first issue` 标签的 Issue
5. **错误修复**：深受感谢！

参见 [CONTRIBUTING_ZH.md](CONTRIBUTING_ZH.md) 了解贡献指南。
