# Docker Compose configuration for running tests
# Usage: cd ros/docker && docker-compose -f docker-compose.test.yml up --abort-on-container-exit

services:
  test-ros1:
    build:
      context: ../..
      dockerfile: ros/docker/Dockerfile.ros1
    container_name: axon_test_ros1
    volumes:
      - ../..:/workspace/axon
    environment:
      - ROS_DISTRO=noetic
      - ROS_VERSION=1
    command: /usr/local/bin/run_integration.sh
    network_mode: host

  test-ros2-humble:
    build:
      context: ../..
      dockerfile: ros/docker/Dockerfile.ros2.humble
    container_name: axon_test_ros2_humble
    volumes:
      - ../..:/workspace/axon
    environment:
      - ROS_DISTRO=humble
      - ROS_VERSION=2
    command: /usr/local/bin/run_integration.sh
    network_mode: host

  test-ros2-jazzy:
    build:
      context: ../..
      dockerfile: ros/docker/Dockerfile.ros2.jazzy
    container_name: axon_test_ros2_jazzy
    volumes:
      - ../..:/workspace/axon
    environment:
      - ROS_DISTRO=jazzy
      - ROS_VERSION=2
    command: /usr/local/bin/run_integration.sh
    network_mode: host

  test-ros2-rolling:
    build:
      context: ../..
      dockerfile: ros/docker/Dockerfile.ros2.rolling
    container_name: axon_test_ros2_rolling
    volumes:
      - ../..:/workspace/axon
    environment:
      - ROS_DISTRO=rolling
      - ROS_VERSION=2
    command: /usr/local/bin/run_integration.sh
    network_mode: host

volumes:
