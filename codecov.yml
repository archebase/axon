# =============================================================================
# Codecov Configuration for Axon
# =============================================================================
# Configures coverage reporting behavior and file exclusions.
# See: https://docs.codecov.com/docs/codecov-yaml
#
# Coverage Strategy:
#   - All coverage (ROS1, ROS2, C++ libs, E2E) is merged locally before upload
#   - Single unified coverage report for the entire project
#   - Path normalization is done in ci.yml merge step (centralized)
# =============================================================================

# Path fixes - NOT needed since paths are normalized before upload in ci.yml
# The merge step normalizes all paths to match repo structure:
#   cpp/axon_logging/*, cpp/axon_mcap/*, ros/axon_recorder/src/*
# See: .github/workflows/ci.yml "Normalize coverage paths" step

coverage:
  status:
    project:
      default:
        target: auto
        threshold: 1%  # Allow 1% coverage drop before failing
    patch:
      default:
        target: auto

# Disable carryforward globally
flag_management:
  default_rules:
    carryforward: false

# Ignore test files, non-source files, and auto-generated files from coverage metrics
ignore:
  # Test files
  - "ros/axon_recorder/test/**/*"
  - "cpp/axon_logging/test/**/*"
  - "cpp/axon_mcap/test/**/*"
  - "cpp/axon_uploader/test/**/*"
  - "**/test/**/*"
  - "**/*_test.cpp"
  - "**/test_*.cpp"
  # Build directory (auto-generated ROS files)
  - "build/**/*"
  # ROS auto-generated code (from .srv/.msg files)
  - "**/rosidl_typesupport_cpp/**/*"
  - "**/rosidl_typesupport_introspection_cpp/**/*"
  - "**/rosidl_typesupport_fastrtps_cpp/**/*"
  - "**/rosidl_generator_cpp/**/*"
  # Non-source files (documentation, config, CI, build scripts)
  - "**/*.md"
  - "**/*.yml"
  - "**/*.yaml"
  - "**/*.xml"
  - "**/*.txt"
  - "**/*.cmake"
  - "**/CMakeLists.txt"
  - "**/*.sh"
  - "**/*.in"
  - ".github/**/*"
  - ".cursor/**/*"
  - ".vscode/**/*"
  - "docs/**/*"
  - "ros/docker/**/*"
  - "**/Makefile"
  - "**/Makefile.*"
  - "**/*.srv"
  - "**/package.xml"
  - "**/launch/**/*"
  - "**/config/**/*"

# Comment configuration for PR feedback
comment:
  layout: "reach,diff,files"
  behavior: default
  require_changes: true
