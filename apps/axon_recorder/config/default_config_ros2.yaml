# Axon Recorder Configuration for ROS2 (Humble/Jazzy/Rolling)
# Usage: ./axon_recorder --config config/default_config_ros2.yaml

# ============================================================================
# Plugin Configuration
# ============================================================================
plugin:
  # Path to the ROS2 plugin shared library
  # If specified, the recorder will automatically load this plugin on startup
  # Common locations:
  #   - Build directory: middlewares/ros2/build/axon_ros2_plugin/libaxon_ros2_plugin.so
  #   - Install directory: /usr/local/lib/axon/plugins/libaxon_ros2_plugin.so
  #   - Relative path: ./lib/libaxon_ros2_plugin.so
  path: ""

  # Optional: JSON configuration passed to the plugin on initialization
  # Example: {"node_name": "custom_node_name", "namespace": "custom_ns"}
  config: ""

# ============================================================================
# Dataset Configuration
# ============================================================================
dataset:
  # Output directory for MCAP files
  # When using HTTP RPC mode, output files are named as: <path>/<task_id>.mcap
  # The task_id is provided via the /rpc/config endpoint
  path: /tmp/axon

  # Output filename (optional, defaults to <path>/recording.mcap)
  output_file: recording.mcap

  # Per-topic queue capacity (number of messages)
  # Recommended: 4096-8192 for high-frequency topics (camera, IMU)
  #              1024-2048 for low-frequency topics (status, diagnostics)
  queue_size: 8192

# ============================================================================
# Subscription Configuration
# ============================================================================
# High-frequency subscriptions (IMU, camera): Use larger batches (100-5000)
# Low-frequency subscriptions (status, diagnostics): Use small batches (1-10)
# Control signals: Use batch_size=1 for immediate persistence
subscriptions:
  # IMU data - high frequency (5 seconds of data per batch)
  - name: /imu/data
    message_type: sensor_msgs/msg/Imu
    batch_size: 5000
    flush_interval_ms: 5000

  # Camera 0 - RGB and Depth (10 seconds of data per batch at 30fps)
  - name: /camera0/rgb
    message_type: sensor_msgs/msg/Image
    batch_size: 300
    flush_interval_ms: 10000

  - name: /camera0/depth
    message_type: sensor_msgs/msg/Image
    batch_size: 300
    flush_interval_ms: 10000

  # Camera 1 - RGB and Depth
  - name: /camera1/rgb
    message_type: sensor_msgs/msg/Image
    batch_size: 300
    flush_interval_ms: 10000

  - name: /camera1/depth
    message_type: sensor_msgs/msg/Image
    batch_size: 300
    flush_interval_ms: 10000

  # Camera 2 - RGB and Depth
  - name: /camera2/rgb
    message_type: sensor_msgs/msg/Image
    batch_size: 300
    flush_interval_ms: 10000

  - name: /camera2/depth
    message_type: sensor_msgs/msg/Image
    batch_size: 300
    flush_interval_ms: 10000

  # Depth image with compression (16UC1 -> CompressedImage with RVL+LZ4)
  - name: /camera/camera/depth/image_rect_raw
    message_type: sensor_msgs/msg/Image
    batch_size: 300
    flush_interval_ms: 10000
    depth_compression: true

# ============================================================================
# Recording Configuration
# ============================================================================
recording:
  # ROS profile: "ros2" for ROS2 Humble/Jazzy/Rolling
  profile: ros2

  # MCAP compression: "none", "zstd", or "lz4"
  # - zstd: Recommended, good balance of speed and compression
  # - lz4:  Faster compression, larger files
  # - none: No compression, fastest, largest files
  compression: zstd
  compression_level: 3  # zstd: 1-19, lz4: 1-12

  # Maximum disk usage (ignored by axon_recorder, used by full service)
  max_disk_usage_gb: 100

# ============================================================================
# Logging Configuration
# ============================================================================
# Can be overridden by environment variables:
#   AXON_LOG_LEVEL          - Global level (overrides both console and file)
#   AXON_LOG_CONSOLE_LEVEL  - Console sink level
#   AXON_LOG_FILE_LEVEL     - File sink level
#   AXON_LOG_FILE_DIR       - Log file directory
#   AXON_LOG_FORMAT         - File format ("json" or "text")
#   AXON_LOG_FILE_ENABLED   - Enable file logging ("true" or "false")
#   AXON_LOG_CONSOLE_ENABLED - Enable console logging ("true" or "false")
logging:
  console:
    enabled: true
    level: info      # debug, info, warn, error, fatal
    colors: true
  file:
    enabled: false   # Set to true to enable file logging
    level: debug
    directory: /var/log/axon
    pattern: "axon_%Y%m%d_%H%M%S.log"
    format: json     # json or text
    rotation_size_mb: 100
    max_files: 10
    rotate_at_midnight: true

# ============================================================================
# HTTP RPC Server Configuration
# ============================================================================
http_server:
  host: "0.0.0.0"                # Bind address (0.0.0.0 for all interfaces)
  port: 8080                     # Port number
  auth_token: ""                 # Authentication token (empty = no authentication)

# ============================================================================
# Edge Upload Configuration
# ============================================================================
# Uploads MCAP and sidecar JSON to S3-compatible storage after recording
upload:
  enabled: false           # Set to true to enable automatic uploads

  # S3 Configuration
  s3:
    endpoint_url: ""       # S3-compatible endpoint (empty for AWS S3)
    bucket: "axon-raw-data"
    region: "us-east-1"
    use_ssl: true
    verify_ssl: true

  # Worker configuration
  num_workers: 2

  # Retry configuration
  retry:
    max_retries: 5
    initial_delay_ms: 1000
    max_delay_ms: 300000
    exponential_base: 2.0
    jitter: true

  # State persistence for crash recovery
  state_db_path: "/var/lib/axon/uploader_state.db"

  # Cleanup policy
  delete_after_upload: true               # Delete device copy after successful upload
  failed_uploads_dir: "/data/failed_uploads/"

  # Backpressure thresholds (GB)
  warn_pending_gb: 8      # ~2 files - emit warning
  alert_pending_gb: 20    # ~5 files - alert operator
