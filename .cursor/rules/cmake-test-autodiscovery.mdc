---
description: Use auto-discovery for test registration in CMake
globs: ["**/CMakeLists.txt"]
alwaysApply: true
---

# CMake Test Auto-Discovery

**Use auto-discovery patterns instead of manually listing each test file.** This reduces maintenance burden and ensures new tests are automatically registered.

## ❌ BAD: Manual Test Listing

```cmake
axon_add_test(NAME test_state_machine SOURCES unit/test_state_machine.cpp LIBS ...)
axon_add_test(NAME test_task_config SOURCES unit/test_task_config.cpp LIBS ...)
# ... 20 more lines
```

## ✅ GOOD: Auto-Discovery

```cmake
file(GLOB TEST_SOURCES CONFIGURE_DEPENDS "unit/test_*.cpp")
foreach(TEST_SOURCE ${TEST_SOURCES})
    get_filename_component(TEST_NAME ${TEST_SOURCE} NAME_WE)
    add_executable(${TEST_NAME} ${TEST_SOURCE})
    target_link_libraries(${TEST_NAME} GTest::gtest_main ${LIBS})
    gtest_discover_tests(${TEST_NAME} PROPERTIES LABELS "unit")
endforeach()
```

## Adding a New Test

```bash
# Just create the file - CMake finds it automatically
touch test/unit/test_my_feature.cpp
```
